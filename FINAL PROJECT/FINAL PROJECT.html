<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Web-Based Study Guide — Demo (Full)</title>
  <style>
    :root{--bg:#f6f8fb;--card:#fff;--muted:#6b7280;--accent:#0b5fff;--accent-2:#073b8c}
    [data-theme='dark']{--bg:#0b1220;--card:#07101a;--muted:#9aa4b2;--accent:#60a5fa;--accent-2:#3b82f6;color:#e6eefc}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:Inter,system-ui,Arial;color:inherit}
    .container{max-width:1100px;margin:24px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{font-size:18px;margin:0}
    .topbar{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
    nav{display:flex;gap:8px;margin-top:16px}
    nav button{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:8px 12px;border-radius:8px;cursor:pointer}
    main{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.04)}
    .list{display:flex;flex-direction:column;gap:8px}
    pre{background:rgba(0,0,0,0.06);padding:10px;border-radius:8px;overflow:auto}
    .hidden{display:none}
    footer{margin-top:18px;color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted)}
    .toggle{display:inline-flex;align-items:center;gap:8px}
    @media (max-width:900px){main{grid-template-columns:1fr}}
  </style>
</head>
<body data-theme="light">
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">WB</div>
        <div>
          <h1>Web-Based Study Guide — Full</h1>
          <div class="small">Firebase Auth · Local progress · Quiz DB · Dark mode · PDF export</div>
        </div>
      </div>

      <div class="topbar">
        <div class="toggle">
          <label for="themeToggle" class="small">Dark</label>
          <input id="themeToggle" type="checkbox" />
        </div>
        <button id="authBtn" class="btn">Login / Register</button>
      </div>
    </header>

    <nav>
      <button onclick="showPage('dashboard')">Dashboard</button>
      <button onclick="showPage('tutorials')">Tutorials</button>
      <button onclick="showPage('exercises')">Exercises</button>
      <button onclick="showPage('quizzes')">Quizzes</button>
      <button onclick="showPage('downloads')">Downloads</button>
    </nav>

    <main>
      <section id="dashboard" class="card">
        <h2>Dashboard</h2>
        <div id="welcomeMsg">Welcome — not signed in</div>
        <div style="margin-top:12px">
          <strong>Progress</strong>
          <div id="progressBar" style="height:12px;background:#e6eefc;border-radius:999px;margin-top:6px;overflow:hidden"><i id="progressFill" style="display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%"></i></div>
          <div class="small" style="margin-top:6px">Completed tutorials: <span id="doneCount">0</span>/<span id="totalCount">0</span></div>
        </div>
        <div style="margin-top:12px">
          <button class="btn" onclick="saveProgressToFirebase()">Sync Progress to Firebase</button>
          <button class="btn" style="background:#10b981;margin-left:8px" onclick="exportProgressPDF()">Download Progress (PDF)</button>
        </div>
      </section>

      <aside style="display:flex;flex-direction:column;gap:12px">
        <div class="card">
          <h4>User</h4>
          <div id="userPanel"><div class="small">Not signed in</div></div>
          <div style="margin-top:8px"><button id="logoutBtn" class="btn hidden" onclick="logout()">Logout</button></div>
        </div>

        <div class="card">
          <h4>Quick Quiz</h4>
          <div class="small">Attempt a 1-question quiz from DB</div>
          <div style="margin-top:8px"><button class="btn" onclick="loadRandomQuestion()">Load Question</button></div>
          <div id="quickQ" style="margin-top:10px"></div>
        </div>

      </aside>

    </main>

    <section id="tutorials" class="card hidden" style="margin-top:16px">
      <h2>Tutorials</h2>
      <div class="list" id="tutorialList"></div>
    </section>

    <section id="exercises" class="card hidden" style="margin-top:16px">
      <h2>Exercises (hard)</h2>
      <div id="exerciseList" class="list"></div>
    </section>

    <section id="quizzes" class="card hidden" style="margin-top:16px">
      <h2>Quizzes</h2>
      <div id="quizList" class="list"></div>
      <div style="margin-top:12px"><button class="btn" onclick="runQuizSession()">Start Quiz Session</button></div>
    </section>

    <section id="downloads" class="card hidden" style="margin-top:16px">
      <h2>Downloads</h2>
      <p class="small">You can export tutorial content or your progress as PDF (client-side).</p>
      <div style="margin-top:8px"><button class="btn" onclick="exportTutorialPDF()">Download Tutorial PDF (current)</button></div>
    </section>

    <footer>Built for demo — replace Firebase config with your project's values before enabling auth.</footer>
  </div>

  <!-- AUTH MODAL -->
  <div id="authModal" class="hidden" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.45)">
    <div style="background:var(--card);padding:18px;border-radius:12px;min-width:320px">
      <h3 id="authTitle">Login / Register</h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <input id="email" placeholder="Email" style="padding:8px;border-radius:8px;border:1px solid #eef2ff" />
        <input id="password" type="password" placeholder="Password" style="padding:8px;border-radius:8px;border:1px solid #eef2ff" />
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="doLogin()">Login</button>
          <button class="btn" style="background:#10b981" onclick="doRegister()">Register</button>
          <button class="btn" style="background:#f59e0b" onclick="doAnon()">Continue as Guest</button>
        </div>
        <div style="margin-top:8px"><button onclick="closeAuth()">Close</button></div>
      </div>
    </div>
  </div>

  <!-- Firebase and libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script>
    // ====== CONFIGURE FIREBASE ======
    // Replace the config below with your Firebase project credentials
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ====== APP STATE ======
    const state = {
      tutorials: [],
      exercises: [],
      quizzes: [],
      user: null,
      progress: {completed: []}
    };

    // Load demo content into DB objects (quiz DB local)
    function seedContent(){
      state.tutorials = [
        {id:'t1',title:'HTML Basics',content:'Structure, tags, semantic elements. <br> Example: &lt;h1&gt;Title&lt;/h1&gt;'},
        {id:'t2',title:'CSS: Box model & Flexbox',content:'Selectors, box model, display:flex;'},
        {id:'t3',title:'JavaScript: DOM & Basics',content:'Variables, functions, events, DOM manipulation.'}
      ];

      state.exercises = [
        {id:'e1',title:'Edit Distance (algorithm)',desc:'Implement Wagner–Fischer algorithm to output edit sequence (hard).',solution:'See pseudocode in notes.'},
        {id:'e2',title:'URL Shortener System Design',desc:'Design a scalable URL shortener and trade-offs.',solution:'Key points: base62, sharding, cache, rate-limit.'}
      ];

      state.quizzes = [
        {id:'q1',q:'Which HTML element is semantic for navigation?',options:['div','nav','span'],answer:1},
        {id:'q2',q:'Which array method returns a new array?',options:['forEach','map','filter'],answer:1}
      ];

      localStorage.setItem('wb_tutorials', JSON.stringify(state.tutorials));
      localStorage.setItem('wb_exercises', JSON.stringify(state.exercises));
      localStorage.setItem('wb_quizzes', JSON.stringify(state.quizzes));
    }

    // ====== UI rendering ======
    function renderTutorials(){
      const container = document.getElementById('tutorialList');
      container.innerHTML = '';
      const list = JSON.parse(localStorage.getItem('wb_tutorials') || '[]');
      document.getElementById('totalCount').innerText = list.length;
      list.forEach(t=>{
        const el = document.createElement('div'); el.className='card';
        el.innerHTML = `<h4>${t.title}</h4><div class=small>${t.content}</div><div style='margin-top:8px'><button class='btn' onclick="markDone('${t.id}')">Mark Done</button> <button class='btn' style='background:#f59e0b;margin-left:6px' onclick="downloadTutorial('${t.id}')">Download PDF</button></div>`;
        container.appendChild(el);
      })
    }

    function renderExercises(){
      const container = document.getElementById('exerciseList'); container.innerHTML='';
      const list = JSON.parse(localStorage.getItem('wb_exercises')||'[]');
      list.forEach(e=>{
        const el=document.createElement('div'); el.className='card';
        el.innerHTML = `<h4>${e.title}</h4><div class=small>${e.desc}</div><div style='margin-top:8px'><button class='btn' onclick="showSolution('${e.id}')">Show Solution</button></div><pre id='sol_${e.id}' class='hidden'>${e.solution}</pre>`;
        container.appendChild(el);
      })
    }

    function renderQuizzes(){
      const container = document.getElementById('quizList'); container.innerHTML='';
      const list = JSON.parse(localStorage.getItem('wb_quizzes')||'[]');
      list.forEach(q=>{
        const el=document.createElement('div'); el.className='card';
        el.innerHTML = `<h4>${q.q}</h4><div class='small'>${q.options.map((o,i)=>`<label style='display:block'><input type='radio' name='quiz_${q.id}' value='${i}' /> ${o}</label>`).join('')}</div>`;
        container.appendChild(el);
      })
    }

    // ====== Interactions ======
    function showPage(id){
      document.querySelectorAll('section.card, section.card.hidden').forEach(s=>s.classList.add('hidden'));
      const el = document.getElementById(id);
      if(el) el.classList.remove('hidden');
      // ensure tutorials/quizzes/exercises list updated
      if(id==='tutorials') renderTutorials();
      if(id==='exercises') renderExercises();
      if(id==='quizzes') renderQuizzes();
    }

    function markDone(tid){
      const prog = JSON.parse(localStorage.getItem('wb_progress')||'{"completed":[]}');
      if(!prog.completed.includes(tid)){ prog.completed.push(tid); localStorage.setItem('wb_progress', JSON.stringify(prog)); updateProgressUI(); alert('Marked done'); }
    }

    function updateProgressUI(){
      const prog = JSON.parse(localStorage.getItem('wb_progress')||'{"completed":[]}');
      const total = JSON.parse(localStorage.getItem('wb_tutorials')||'[]').length;
      document.getElementById('doneCount').innerText = prog.completed.length;
      document.getElementById('totalCount').innerText = total;
      const pct = total? Math.round(prog.completed.length/total*100):0;
      document.getElementById('progressFill').style.width = pct+'%';
    }

    function showSolution(id){
      const pre = document.getElementById('sol_'+id);
      pre.classList.toggle('hidden');
    }

    function runQuizSession(){
      const list = JSON.parse(localStorage.getItem('wb_quizzes')||'[]');
      let score=0; list.forEach(q=>{
        const inputs = document.getElementsByName('quiz_'+q.id);
        for(const i of inputs) if(i.checked){ if(Number(i.value)===q.answer) score++; break; }
      });
      alert('Quiz finished. Score: '+score+'/'+list.length);
    }

    function loadRandomQuestion(){
      const list = JSON.parse(localStorage.getItem('wb_quizzes')||'[]');
      if(!list.length) return alert('No questions');
      const q = list[Math.floor(Math.random()*list.length)];
      const container = document.getElementById('quickQ');
      container.innerHTML = `<div><strong>${q.q}</strong></div>${q.options.map((o,i)=>`<label style='display:block'><input type='radio' name='quick_${q.id}' value='${i}'/> ${o}</label>`).join('')}<div style='margin-top:8px'><button class='btn' onclick="checkQuick('${q.id}',${q.answer})">Check</button></div>`;
    }

    function checkQuick(id,ans){
      const inputs = document.getElementsByName('quick_'+id);
      for(const i of inputs){ if(i.checked){ alert(i.value==ans? 'Correct!':'Incorrect'); return; } }
      alert('Pick an answer');
    }

    // ====== PDF Export (jsPDF) ======
    async function exportTutorialPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const tuts = JSON.parse(localStorage.getItem('wb_tutorials')||'[]');
      doc.setFontSize(16); doc.text('Tutorials Export',14,20);
      doc.setFontSize(11);
      let y = 30;
      tuts.forEach((t,i)=>{
        doc.text(`${i+1}. ${t.title}`,14,y); y+=6; doc.text(String(t.content).replace(/<[^>]*>/g,''),14,y); y+=10; if(y>270){doc.addPage(); y=20}
      });
      doc.save('tutorials.pdf');
    }

    async function exportProgressPDF(){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const prog = JSON.parse(localStorage.getItem('wb_progress')||'{"completed":[]}');
      doc.text('Progress Report',14,20);
      doc.text('Completed tutorials: '+prog.completed.length,14,30);
      doc.save('progress.pdf');
    }

    function downloadTutorial(id){
      // download single tutorial
      const tuts = JSON.parse(localStorage.getItem('wb_tutorials')||'[]');
      const t = tuts.find(x=>x.id===id); if(!t) return alert('Not found');
      const { jsPDF } = window.jspdf; const doc = new jsPDF(); doc.text(t.title,14,20); doc.text(String(t.content).replace(/<[^>]*>/g,''),14,30); doc.save(`${t.title.replace(/\s+/g,'_')}.pdf`);
    }

    // ====== Firebase Auth ======
    document.getElementById('authBtn').addEventListener('click', ()=>{ document.getElementById('authModal').classList.remove('hidden'); });
    function closeAuth(){ document.getElementById('authModal').classList.add('hidden'); }

    async function doRegister(){
      const email = document.getElementById('email').value; const pw = document.getElementById('password').value;
      try{ const u = await auth.createUserWithEmailAndPassword(email,pw); alert('Registered: '+u.user.email); closeAuth(); }
      catch(e){ alert('Register error: '+e.message); }
    }
    async function doLogin(){
      const email = document.getElementById('email').value; const pw = document.getElementById('password').value;
      try{ const u = await auth.signInWithEmailAndPassword(email,pw); alert('Signed in: '+u.user.email); closeAuth(); }
      catch(e){ alert('Login error: '+e.message); }
    }
    async function doAnon(){ try{ await auth.signInAnonymously(); alert('Signed in as guest'); closeAuth(); }catch(e){ alert('Error: '+e.message); } }

    function logout(){ auth.signOut(); }

    auth.onAuthStateChanged(user=>{
      state.user = user;
      const panel = document.getElementById('userPanel');
      const welcome = document.getElementById('welcomeMsg');
      if(user){ panel.innerHTML = `<div class='small'>${user.email?user.email:'(guest)'}</div>`; document.getElementById('logoutBtn').classList.remove('hidden'); welcome.innerText = 'Welcome, ' + (user.email||'Guest'); }
      else{ panel.innerHTML = `<div class='small'>Not signed in</div>`; document.getElementById('logoutBtn').classList.add('hidden'); welcome.innerText = 'Welcome — not signed in'; }
    });

    // Save progress to Firestore under users collection (if signed in)
    async function saveProgressToFirebase(){
      if(!state.user || !state.user.uid){ return alert('Sign in first'); }
      const prog = JSON.parse(localStorage.getItem('wb_progress')||'{"completed":[]}');
      try{ await db.collection('users').doc(state.user.uid).set({progress:prog}); alert('Progress synced to Firebase'); }
      catch(e){ alert('Error saving: '+e.message); }
    }

    // ====== Dark mode toggle persisted in localStorage ======
    const themeToggle = document.getElementById('themeToggle');
    const currentTheme = localStorage.getItem('wb_theme') || 'light';
    document.body.setAttribute('data-theme', currentTheme);
    themeToggle.checked = currentTheme === 'dark';
    themeToggle.addEventListener('change', ()=>{
      const t = themeToggle.checked ? 'dark':'light'; document.body.setAttribute('data-theme', t); localStorage.setItem('wb_theme', t);
    });

    // ====== Boot ======
    (function boot(){
      // seed if missing
      if(!localStorage.getItem('wb_tutorials')) seedContent();
      renderTutorials(); renderExercises(); renderQuizzes(); updateProgressUI();
    })();

  </script>
</body>
</html>